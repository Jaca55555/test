<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <object th:include="fragments/includes_top :: top" th:remove="tag"></object>
    <link rel="stylesheet" href="/static/datatables/css/datatables.min.css">
    <!-- Bootstrap datetimepicker css -->
    <link rel="stylesheet" href="/static/plugins/bootstrap-datetimepicker/css/bootstrap-datepicker3.min.css">
    <link rel="stylesheet" th:href="@{/static/modal-window-effects/css/md-modal.css}">
    <style>
        :root {
            height: 100%;
        }

        .table td, .table th {
            white-space: pre-line;
        }

        .datepicker > .datepicker-days {
            display: block;
        }

        .card-body {
            height: 300px;
        }

        .row {
            display: flex;
            flex-direction: row;
            gap: 150px;
            max-width: 1005px;
            width: 100%;
            max-height: 83px;
            height: 100%;
            box-sizing: border-box;
        }

        .form-group {
            display: flex;
            flex-direction: row;
            align-self: center;
            max-width: 150px;
            width: 100%;
            max-height: 50px;
            height: 100%;
            min-height: 83px;
            margin-top: 32px;
            box-sizing: border-box;
        }

        .didox__wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 25px;
            width: 100%;
            max-height: 25px;
            hegiht: 100%;

        }

        .btn {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 120px;
            width: 100%;
            max-height: 50px;
            height: 100%;

        }
    </style>
</head>
<body class="layout-6">
<!-- [ Pre-loader ] start -->
<div class="loader-bg">
    <div class="loader-track">
        <div class="loader-fill"></div>
    </div>
</div>
<!-- [ Pre-loader ] End -->

<object th:include="fragments/navigation_menu :: menu" th:remove="tag"></object>

<object th:include="fragments/header :: head" th:remove="tag"></object>

<!-- [ Main Content ] start -->
<div class="pcoded-main-container">
    <div class="pcoded-wrapper">
        <div class="pcoded-content">
            <div class="pcoded-inner-content">
                <div class="main-body">
                    <div class="page-wrapper">
                        <!-- [ Main Content ] start -->
                        <div class="row">
                            <!-- [ sample-page ] start -->
                            <div class="col-sm-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 th:text="#{sys_didox}"></h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <div class="row">
                                                    <div class="col-sm-3 col-md-3">
                                                        <label for="didoxId" th:text="#{didox.id}">id</label>
                                                        <input type="text" class="form-control" id="didoxId"
                                                               placeholder="id" autocomplete="off">
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="didox__wrapper">
                                                            <input type="checkbox"
                                                                   id="didoxStatus" class="didoxStatus"
                                                                   placeholder="Active"/>
                                                        </div>

                                                        <label for="didoxStatus">didoxStatus </label>
                                                    </div>
                                                    <div class="col-sm-3 col-md-2" style="margin-top: 28px;">
                                                        <a href="#"
                                                           onclick="getDatatableConnect();return false;"
                                                           class="btn btn-outline-primary"><i
                                                                class="feather icon-search"></i>
                                                            <span class="didox_search"
                                                                  th:text="#{sys_send}">Поиск</span>
                                                        </a>
                                                    </div>
                                                </div>

                                                <div class="table-responsive break-word" id="result">
                                                    <table id="data-table"
                                                           class="table table-striped table-hover dataTable"
                                                           style="width: 100%">
                                                        <thead>
                                                        <tr>
                                                            <th th:text="#{didox.id}"></th>
                                                            <th th:text="#{didox.params}"></th>
                                                            <th th:text="#{didox.status}"></th>
                                                            <th th:text="#{didox.response}"></th>
                                                            <th th:text="#{didox.regApplicationId}"></th>
                                                            <th th:text="#{didox.createdAt}"></th>
                                                            <th th:text="#{didox.updatedAt}"></th>
                                                            <th th:text="#{didox.createAtById}"></th>
                                                            <th th:text="#{didox.updatedById}"></th>
                                                            <th th:text="#{sys_about.material}"></th>
                                                            <th></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- [ sample-page ] end -->
                                </div>
                                <!-- [ Main Content ] end -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ Main Content ] end -->
        <object th:include="fragments/includes_bottom :: bottom" th:remove="tag"></object>
        <script th:src="@{/static/datatables/datatables.min.js}"></script>
        <script type="text/javascript" src="/static/datatables/jquery.spring-friendly.min.js"></script>
        <script type="text/javascript"
                src="/static/plugins/bootstrap-datetimepicker/js/bootstrap-datepicker.min.js"></script>
        <script type="text/javascript" src="/static/js/form.js?v=28122016"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        <script th:inline="javascript">
            var didoxStatus = false;

            var viewLink = ""; // bu yerga link qoyish kerak
            var ajaxRequestLink = [[${T(uz.maroqand.ecology.cabinet.constant.mgmt.MgmtUrls).DidoxAjaxList}]];
            var notSending = [[#{status_not_sending}]]
            var sending = [[#{sys_sending}]]
            var sysForSending = [[#{sys_for.sending}]]
            var none = [[#{no_data}]]

            function getCurrentLanguage() {
                return [[__${#locale}__]];
            }
        </script>
        <script th:inline="none">
            /*<![CDATA[*/
            var cDataTable;
            var dataDatatableSelector;
            var thead;

            function renderActionsColumn(data, type, row, meta) {
                var currentViewLink = viewLink; // bu yerni xam togirlanadi
                var html = '';
                html += '<div class="btn-group">' +
                    '<a class="btn btn-info btn-sm mr-1" href="' + currentViewLink + '" title="' + sysForSending + '"><i class="feather icon-eye" style="margin-right: 0px;"></i></a>';
                return html;
            }

            function didoxStatusCheck(checkbox) {
                if (checkbox.checked) {
                    didoxStatus = true;
                } else {
                    didoxStatus = false;
                }

            }

            function eventActiveity(data, type, row, meta) {
                var html = '';

                if (row[6]) {
                    html += '<span class="text-primary">' + sending + ' </span>'
                } else {
                    html += '<span class="text-danger"> ' + notSending + '</span>'
                }
                return html;
            }

            function erroringHandle(data, type, row, meta) {
                var html = '';

                if (row[6]) {
                    html += '<span class="text-primary" style="max-width: 300px; overflow: hidden" >' + none + ' </span>'
                } else {
                    html += '<span class="text-danger" style="max-width: 100px; overflow: hidden" >' + row[5] + ' </span>'
                }

                return html;
            }

            function datatableConnect() {
                dataDatatableSelector.DataTable({
                    processing: true,
                    serverSide: true,
                    scrollX: false,
                    pageLength: 25,
                    autoWidth: false,
                    columnDefs: [
                        {"width": "550px", "targets": 3}
                    ],
                    lengthMenu: [[25, 500, 1000], [25, 500, 1000]],
                    order: [[1, 'asc']],
                    dom: 'lrtip',
                    stateSave: true,
                    ajax: function (dataToSend, callback, settings) {
                        var api = this.api();
                        var order = api != undefined ? api.order() : [[1, 'desc']];
                        dataToSend.sort = dataToSend.columns[order[0][0]].name + ',' + order[0][1];
                        dataToSend.didoxId = $('#didoxId').val();
                        console.log($('#didoxId').val())
                        dataToSend.didoxStatus = didoxStatus;
                        console.log($('#didoxStatus').val())

                        $.get(ajaxRequestLink, dataToSend, function (data) {
                            callback(data);
                        });
                    },
                    columns: [
                        {data: 0, name: 'id'},
                        {data: 1, name: 'params'},
                        {data: 2, name: 'status'},
                        {data: 3, name: 'response'},
                        {data: 4, name: 'regApplicationId'},
                        {data: 5, name: 'createAt'},
                        {data: 6, name: 'updatedAt'},
                        {data: 7, name: 'createAtById'},
                        {data: 8, name: 'updatedById'},
                        {render: erroringHandle},
                        {render: eventActiveity},
                        {data: 7, orderable: false},
                        {render: renderActionsColumn, orderable: false}
                    ],
                    language: {
                        'url': '/static/datatables/lang_' + getCurrentLanguage() + '.json'
                    }
                });
            }

            function getDatatableConnect() {
                dataDatatableSelector.DataTable().destroy();
                dataDatatableSelector.html(thead);
                datatableConnect();
            }

            $(document).ready(function () {
                dataDatatableSelector = $('#data-table');
                thead = dataDatatableSelector.html();
                datatableConnect();
            });

            $('#data-table').css("width", "100%");
            $('#data-table td').css("max-width", "100px");
        </script>
</body>
</html>